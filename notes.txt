
Crowdfunding marketplace from Codeplace in Rails 5

 Install default Rails 5 app

gem install rails
rails -v // 5.02
rails new stukstarter // stukstarter/ folder created,
    how to run rails 5 on c9.io?
cd stukstarter; rails server -b $IP -p $PORT;
    it's running, how to get to it?
click on 'Share' next to gear in c9 workspace, copy the 2nd link, paste in new tab and run
git init; git add --all; git commit -m "Initial setup"
git status;
git log --oneline;

git remote add origin https://github.com/ImsirovicAjdin/codeplace-three.git
git commit -m "Add remote repo"
git push -u origin master

1
INSTALL BOOTSTRAP-SASS
Sass (Syntactically Awesome Style Sheets) is a CSS extension language with lots of features, one of the most important being the ability to create variables.
Variables are "a way to store information that you want to reuse throughout your stylesheet. You can store things like colors, font stacks, or any CSS value you think you'll want to reuse".
 Check out the "Sass Basics" on Sass's website (http://sass-lang.com/guide) for more info.
Since we're working with Ruby on Rails, we'll need to implement the 'bootstrap-sass' gem , which is a Sass-powered version of Bootstrap 3.

Let's start by visiting the  gem's official github repository.
Scroll down to the "Installation" chapter to see all the information you need to get started.
https://github.com/twbs/bootstrap-sass#installation

As you can see, we need to have two gems installed: 'bootstrap-sass' and  'sass-rails';
If you notice, the 'sass-rails' gem is already in your Gemfile  (it's installed by default when you install Rails).
So, we only need to add the 'bootstrap-sass' gem.
(A)
gem 'bootstrap-sass', '~> 3.3.6'
As always, let's run the  bundle install  command to install it.
(B)
Next, we need to rename the application.css file (inside app > assets > stylesheets) as application.scss and delete all its content.
Copy the imports  on the github page and paste them on the file, as shown below.

(C) Lastly, we need to require  bootstrap-sprockets  in our  application.js  file (inside app > assets > javascripts).
./app/assets/javascripts/application.js
    //= require jquery
    //= require jquery_ujs
    //= require turbolinks
    //= require bootstrap-sprockets
    //= require_tree .

(D) Git add "bootstrap-sass" gem, application.scss, application.js

2
INSTALLING FONT AWESOME
Since we're working with Ruby on Rails, we'll need to implement the 'font-awesome-rails ' gem, "which provides the Font-Awesome web fonts and stylesheets as a Rails engine for use with the asset pipeline".
https://github.com/bokmann/font-awesome-rails
https://github.com/bokmann/font-awesome-rails#installation

The first step, as always, is to add the gem to our Gemfile .
Once again, let's run  bundle install .
Finally, since we're using Sass, we need to import Font Awesome in our  application.scss file.

// "bootstrap-sprockets" must be imported before "bootstrap" and "bootstrap/variables"
@import "font-awesome";
@import "bootstrap-sprockets";
@import "bootstrap";

git commit -m "Add font awesome"

3
CREATING THE SASS FILES
Let's create all the stylesheets  our application needs.
Let's start by creating a new file called "header.scss" and let's save it in the same directory as the  application.scss  file (app > assets > stylesheets).

Next, copy all the code highlighted below and paste it in the newly-created Sass file.
    ./app/assets/stylesheets/header.scss
    
Repeat the process for these next files:
./app/assets/stylesheets/landing.scss
./app/assets/stylesheets/projects.scss
./app/assets/stylesheets/settings.scss
./app/assets/stylesheets/variables.scss
./app/assets/stylesheets/pledges.scss
./app/assets/stylesheets/devise.scss

Now, we need to import all the files we've created on the  application.scss  file. 

Finally, we need to fetch our app's logo from the Stuk github repository and add it to the app > assets > image directory.
GIT COMMIT -m "Add scss and logo to assets"

4
USER AUTH - INSTALLING DEVISE AND CREATING THE USER MODEL

Devise is a very popular user authentication solution for Rails.

's a complete MVC solution and it's modular, so you only use what you really need.
 For more information, please visit the "Getting started" section on Devise's official github repository page (https://github.com/plataformatec/devise).
Step 1
Let's start by adding the gem  to our Gemfile .
# Devise
gem 'devise'
Step 2
As always, let's run the bundle  command to install it.
Step 3
Now, we need to run the generator, which installs an initializer  that describes all of Devise's configuration options.
rails generate devise:install

RAILS GENERATE DEVISE:VIEWS

Step 4
At this point, we can add Devise to a model.
Let's add it to a new "User" model.

rails generate devise USER

Step 5
Before we migrate the table, let's open the  migration file  and let's add an extra field: customer_id.
We'll do it now to prevent an extra migration down the road but, for now, this field doesn't have much use for us.
    ./db/migrate/[]_devise_create_users.rb
        ## Customer ID
        t.string :customer_id
        
Step 6
We're finally ready to migrate  the table.
    rake db:migrate

Step 7
Ok, let's run the server and see what we have so far.
rails s

Step 8
If you go to http://localhost:3000/users/sign_up, you can see we already have a sign up form with the CSS styles we've implemented before.

Step 9
The same goes for the http://localhost:3000/users/sign_in page.

5
STYLING DEVISE'S VIEWS
Step 1
Let's start by styling the sign in page.
Open up the "new.html.erb" file inside the views > devise > sessions directory.
We'll need to create some new divs with specific class names, to make sure Bootstrap's styles are correctly applied.
 Please visit Bootstrap's CSS page (http://getbootstrap.com/css/) for more info.
    ./app/views/devise/sessions/new.html.erb

Step 2
Also, let's improve the "Log in" button with a little Bootstrap magic.
Step 3
If you go back to the application and refresh the page, you'll see that the log in form looks a little different.
Step 4
Now, let's basically do the same for the sign up view.
Go to views > devise > registrations and open up the "new.html.erb" file.
Wrap the content with the same divs as before.
Also, we're going to add the same class to the "Sign Up" button.
Step 5
Now our sign up page looks very much like our log in page.
Step 6
OK, the final page we're going to style is the settings page, i.e., the "edit.html.erb" file inside views > devise > registrations.
Let's add the exact same divs and let's add the the same class to the "Update" button.


******************
ERROR:
rails db:migrate SQLite3::SQLException: duplicate column name
SOLUTION:
try migrating your DB to version=0 with command: rake db:migrate VERSION=0
and then run  rake db:migrate

rake db:reset_password_sent_at
rake db:migrate:reset
rake db:drop:all

Environment data not found in the schema. To resolve this issue, run: 

        bin/rails db:environment:set RAILS_ENV=development
******************

dba16fb20d2e79b96cb4dec15cb90afd21fd6ae3

##########
6
CREATING AND CONFIGURING THE PROJECT MODEL

Step 1
Let's generate the "Project" model without adding any fields.
    rails generate model Project

Step 2
Now, let's open up our  migration file  and let's add all the fields our "projects" table is going to need.
First, we need to reference the "users" table by creating a new  foreign key - this key is going to create a new field called user_id.
Our projects are also going to need a name, a short description, a description, an image url, a status, a goal and an expiration date.
    ./db/migrate/[]_create_projects.rb

Step 3
We can now migrate  the database.
    rake db:migrate

Step 4
Finally, we need to establish the relationships between the "User" and "Project" models:
    A user can have many projects.

And a project belongs to a user.

git commit -m "Create and configure the project model"

############
7
 ADDING THE NAVBAR
 
Step 1
The first thing we need to do is to create a new "header" partial, where we'll put the navbar.
touch app/views/layouts/_header.html.erb

 Step 2
Next, let's go to the "Components" section of Bootstraps' website and let's scroll down to the "Navbar" component.
Click on the "Copy" button shown below, and paste the content inside the partial.
    ./app/views/layouts/_header.html.erb

Step 3
Let's remove some stuff we don't need, like the dropdown and the form.

Step 4
If we clean up our code a little bit, we should have something like this.
./app/views/layouts/_header.html.erb

<nav class="navbar navbar-default">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">Brand</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <li></li>
        <li></li>
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

Step 5
Let's add the header partial to our  application.html.erb  file, just so we can see what we've got so far.
./app/views/layouts/application.html.erb
<!DOCTYPE html>
<html>
<head>
  <title>Stukstarter</title>
  <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>
  <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
  <%= csrf_meta_tags %>
</head>
<body>

<%= render "layouts/header" %>
<%= yield %>

</body>
</html>

Step 6
As always, you need to start the server.
( If you're logged in, open up a new browser window in incognito mode.)

 Step 7
As you can see, your application now has a navigation bar.

git commit -m "Add the navbar"

############
8
CUSTOMIZING THE NAVBAR

Step 1
We're going to start by adding the "Stukstarter" logo where the "Brand" element used to be.
As you can see in the code highlighted below, we've added an  image tag  with just the file name - there's no need for the path, since the image is in the default directory (app > assets > images).
Also, we've added a "logo" class to our element. This class has already been styled in the stylesheets we added in the beginning of this course.
Later, we'll link the image to the root_path, but since this path isn't defined yet, for now our link's destination is the current page.
./app/views/layouts/_header.html.erb

Step 2
Take a look at your cool new logo!

Step 3
Next, we need to alter the navbar options according to the user's status.
For this, we'll need to add an if statement to our partial:
if the user's signed in, he/she should be able to start a new project, see the account settings, and sign out;
if not, he/she should be able to sign up and log in;
Note that we haven't defined a lot of the paths we're going to need, so for now, most of our links are going to the current page ("#").

Step 4
As you can see, our navbar options now change according to our status.

git commit -m "Dynamically Customize the navbar"

############
9
DEFINING THE ROOT PATH

Step 1
Our application is going to have a landing page (the root path) that's going to display all the projects in our table.
This is going to be the "index" action  of the "projects" controller .
So, first thing we need is a "projects" controller. Let's create one!
rails g controller projects

Since we've already created a stylesheet called "projects.scss", this generator is going to raise a conflict regarding that file. Press the "n" key to skip it. Otherwise, the generator is going to override it.

Step 2
Next, we need to go to the controller and define the  "index" action .
./app/controllers/projects_controller.rb

class ProjectsController < ApplicationController
  def index
  end
end

Step 3
We're ready to define our  root route , inside the  routes.rb file, as the "index" action of the "projects" controller.

./config/routes.rb
Rails.application.routes.draw do
  root 'projects#index'
  
 Step 4
Ok, so all that's left to do is to add a template  for this action.
Let's do it by creating a new "index.html.erb" file inside the "projects" directory.
 touch app/views/projects/index.html.erb

Step 5
We'll come back to this template in the next chapter, but for now, let's just put a level 1 heading with the text "Hello, world".
./app/views/projects/index.html.erb
<h1>Hello, World</h1>

Step 6
If we go to the root of the application, we should see the navbar and the "Hello, world" message.

git commit -m "Define the root path"

###########
10
CREATING THE CAROUSEL

Step 1
Our landing page is going to have a carousel, so we need to start by creating a partial where we'll put this element.
touch app/views/projects/_carousel.html.erb

Step 2
Next, let's go to Bootstrap's "Javascript" page and let's scroll down to the "Carousel" chapter.
Click on the "Copy" button, as shown below, and paste all the content on the partial
./app/views/projects/_carousel.html.erb

        <div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
          <!-- Indicators -->
          <ol class="carousel-indicators">
            <li data-target="#carousel-example-generic" data-slide-to="0" class="active"></li>
            <li data-target="#carousel-example-generic" data-slide-to="1"></li>
            <li data-target="#carousel-example-generic" data-slide-to="2"></li>
          </ol>
        
          <!-- Wrapper for slides -->
          <div class="carousel-inner" role="listbox">
            <div class="item active">
              <img src="..." alt="...">
              <div class="carousel-caption">
                ...
              </div>
            </div>
            <div class="item">
              <img src="..." alt="...">
              <div class="carousel-caption">
                ...
              </div>
            </div>
            ...
          </div>
        
          <!-- Controls -->
          <a class="left carousel-control" href="#carousel-example-generic" role="button" data-slide="prev">
            <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
          </a>
          <a class="right carousel-control" href="#carousel-example-generic" role="button" data-slide="next">
            <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
          </a>
        </div>

Step 3
Let's remove the heading and let's add the partial to the index view.
./app/views/projects/index.html.erb
<%= render "projects/carousel" %>

Step 4
Let's take a look at our application to see if the carousel works "straight out of the box" or if we need to make some adjustments.
rails s

Step 5
As you can see, the carousel is working correctly, even though we don't have any images yet.

Step 6
Of course, the idea is to have a dynamic carousel and not to hardcode the images'URLs.
However, just for test purposes, let's add an image to the carousel.
./app/views/projects/_carousel.html.erb

  <!-- Wrapper for slides -->
  <div class="carousel-inner" role="listbox">
    <div class="item active">
      <img src="http://images.freeimages.com/images/previews/5b0/rubik-s-cube-1-1424892.jpg" alt="...">

Step 7
As you can see, the image is displayed correctly.
We can see the 3 little buttons below and the arrows.
Everything's OK, let's move on!

git commit -m "Create the carousel"

##############
11
DISPLAYING THE PROJECTS

Step 1
Below the carousel, we're going to create a couple of divs with Bootstrap specific classes where we're going to display the projects.
./app/views/projects/index.html.er
<%= render "projects/carousel" %>

<div class="container">
	<br><br><br>
	<h3 class="project-subtitle">Our Project</h3>
	<div class="row">
		
	</div>
</div>

Step 2
Next, let's create a "project" partial.
touch app/views/projects/_project.html.erb

Step 3
Our partial is going to include the project's title, description, progress bar and stats, as shown below.

./app/views/projects/_project.html.erb
        <div class="col-md-4 col-sm-6 col-xs-12">
        
          <div class="project-box">
            <img src="http://images.freeimages.com/images/previews/5b0/rubik-s-cube-1-1424892.jpg" alt="..." width="100%" height="200px">
            <div class="description-box">
        
              <!-- Project Title -->
              <div class="title">
        	  </div>
        
        	  <!-- Project Description -->
        	  <div class="description">
        	    This is a description
        	  </div>
        
        	  <!-- Project Progress Bar -->
        	  <div clas="project-bar">
        	    <div class="progress">
        	      <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="100%" aria-valuemin="0" aria-valuemax="100" style="width:100%">
        	    	<span class="sr-only">100% Complete (Success)</span>
        	      </div>
        	    </div>
        	  </div>
        
        	  <!-- Project Stats -->
        	  <div class="stats">
        	    <ul>
        	  	  <!-- percentage of funding -->
        	  	  <li>100% <br><span class="label">funded</span></li>
        	  	  <!-- total amount pledged (dollars) -->
        	  	  <li>$1000 <br><span class="label">pledged</span></li>
        	  	  <!-- days to go 'till deadline -->
        	  	  <li>10 <br><span class="label">days to go</span></li>
        	    </ul>
              </div>
        
            </div>
          </div>
        
        </div>
        
Step 4
Let's render the partial in the index template.
./app/views/projects/index.html.er
<%= render "projects/carousel" %>

<div class="container">
	<br><br><br>
	<h3 class="project-subtitle">Our Project</h3>
	<div class="row">
		<%= render "project" %>
	</div>
</div>

Step 5
OK, let's see how this partial looks in our landing page.
rails s

As you can see, we now have a project block with all the project's info.

Step 6
Our landing page is missing something ... there's no way for us to create a new project.
So, let's add a new link below the project blocks.
Note that the path is not yet configured, so the link's destination is the current page.
./app/views/projects/index.html.er
...
	<h3 class="project-subtitle">Our Project</h3>
	<div class="row">
		<%= render "project" %>
	</div>
</div>

<div class="container text-center">
	<br><br><br>
	<h2>Create your first project</h2>
	<%= link_to "Start project!", "#", class: "btn btn-success btn-lg" %>
</div>

Step 7
Now we have a problem ... this button should only appear when the user doesn't have any projects.
Step 8
Let's fix that by creating an if/else statement:
if our user has projects to display, we should display them;
else, we should display the "Start project" button;
As you can see, our if statement is using the @displayed_projects  global variable  which doesn't exist.
./app/views/projects/index.html.er
        <% if @displayed_projects.any? %>
        
        <%= render "projects/carousel" %>
        
          <div class="container">
        	<br><br><br>
        	<h3 class="project-subtitle">Our Project</h3>
        	<div class="row">
        	  <%= render "project" %>
        	</div>
          </div>
        
        <% else %>
        
          <div class="container text-center">
        	<br><br><br>
        	<h2>Create your first project</h2>
        	<%= link_to "Start project!", "#", class: "btn btn-success btn-lg" %>
          </div>
        
        <% end %>

Step 9
So, inside the projects controller, let's state that the  @displayed_projects  global variable  corresponds to the 4 first entries of the "projects" table.

./app/controllers/projects_controller.rb
class ProjectsController < ApplicationController
  def index
    @displayed_projects = Project.take(4)
  end
end

 Step 10
We also need to define a @projects  global variable  in the controller, which is going to represent all the entries in the "projects" table.

./app/controllers/projects_controller.rb
class ProjectsController < ApplicationController
  def index
    @projects = Project.all
    @displayed_projects = Project.take(4)
  end
end

Step 11
In the "index" view, we can now replace the "project" partial with the  global variable  @projects.

./app/views/projects/index.html.er
        <% if @displayed_projects.any? %>
        
        <%= render "projects/carousel" %>
        
          <div class="container">
        	<br><br><br>
        	<h3 class="project-subtitle">Our Project</h3>
        	<div class="row">
        	  <%= render @projects %>
        	</div>
          </div>
        
        <% else %>
        
          <div class="container text-center">
        	<br><br><br>
        	<h2>Create your first project</h2>
        	<%= link_to "Start project!", "#", class: "btn btn-success btn-lg" %>
          </div>
        
        <% end %>

Step 12
Now, let's go back to our application.
rails s

Step 13
As you can see, since we don't have any projects, all we can see for now is the "Create your first project" button.

git commit -m "Display the projects"

#############
12
INSTALLING THE "ANNOTATE MODELS" GEM
We're going to install a really useful gem called "annotate models", which does exactly what the name says: it annotates schema information for you.
 Please visit the gem's official github repository (https://github.com/ctran/annotate_models) for more info.
Step 1
As always, the first thing we need to do is to add the gem to the Gemfile .
# Annotate Models
gem 'annotate', github: 'ctran/annotate_models'
Step 2
Let's install the gem.
bundle install # won't work, use 'bundle update' to push through
Step 3
To start using the gem , all you need to do is type the following command.
annotate
As you can see, the output for the command is the list of annotated models, in this case, "Project" and "User".
Step 4
Notice that now, when we open a model, we can see the schema information above the model's settings.
This is going to be very useful when we need to create test projects directly on the Rails console.

git commit -m "Install the annotate-models gem"

#############
13
CREATING A NEW TEST PROJECT
In order to test our features, our "projects" table must be populated. 
Since we still haven't built an interface, like a form, to create new projects, let's do it directly on the console.

Step 1
So, first thing we need to do is start the  Rails console .
rails c

Step 2
Next, let's create a project with the following parameters:
user_id:1
name:"Kube"
short_description:"It's my first project"
description:"This is my long description!"
image_url:"http://images.freeimages.com/images/previews/5b0/rubik-s-cube-1-1424892.jpg"
goal:1000

p = Project.new(user_id:1, name:"Kube", short_description:"It's my first project", description:"This is my long description!", image_url:"http://images.freeimages.com/images/previews/5b0/rubik-s-cube-1-1424892.jpg", goal:1000 )
p.save                                                            
Step 3
Let's check that everything is OK.
We should only have one project in our database, with the parameters you've defined before.
Project.count
Project.first

git commit -m "Create a new test project"


#############
14
DYNAMIC CAROUSEL
Step 1
Now that we have a project, we can start creating a truly dynamic carousel.
Let's start by passing the "projects" variable to the carousel partial, which is going to include the 4 displayed projects.
./app/views/projects/index.html.erb
<% if @displayed_projects.any? %>

<%= render "carousel", projects: @displayed_projects %>
....
Step 2
Starting with the carousel indicators, we're going iterate through all of the projects displayed and fill out the "data-slide-to" and "class" fields dynamically.
As you can see in the code highlighted below, if i is zero, we know the current project is the first one, which means this should be the project with the "active" class.
./app/views/projects/_carousel.html.erb
    <div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
      <!-- Indicators -->
      <ol class="carousel-indicators">
          <% projects.count.times do |i| %>
            <li data-target="#carousel-example-generic" data-slide-to="<%= i %>" class="<%= "active" if i.zero? %>"></li>
          <% end %>
      </ol>
    
      <!-- Wrapper for slides -->
      ...

Step 3
Now, for the slides, we need to remove all the stuff we don't need and we need to add the same logic as before: for each project in the "displayed_objects" variable, display the project's image, name and short description.
Also, we've added a link to "View Project", which for now just links to the current page ("#").
./app/views/projects/_carousel.html.erb
....
          <!-- Wrapper for slides -->
          <div class="carousel-inner" role="listbox">
            <% projects.each_with_index do |project, index| %>
              <div class="item <%= "active" if index.zero? %>">
                <img src="<%= project.image_url %>" alt="...">
                <div class="carousel-caption">
                  <div class="container">
                    <h2><%= project.name %></h2>
                    <p><%= project.short_description %></p>
                    <%= link_to "View Project", "#", class: "btn btn-success btn-lg" %>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        
            <!-- Controls -->
....

Step 4
As you can see, we now have a truly dynamic carousel.
However, this is hard to test, since we only have one slide that corresponds to our only entry in the database.

git commit -m "Add dynamic carousel"




#############
15
DYNAMIC PROJECTS

#############
16
NEW PROJECT FORM

#############
17
CREATING NEW PROJECTS

#############
18
UPDATING AND DELETING PROJECTS

#############
19
EDITING THE SHOW VIEW

#############
20
CREATING THE REWARD MODEL

#############
21
MORE DATE GEMS

#############
22
NEW REWARD FORM

#############
23
CREATING NEW REWARDS

#############
24
UPDATING AND DELETING REWARDS

#############
25
STYLING THE VIEWS

#############
26
ADDING MISSING LINKS

#############
27
CREATING THE PLEDGE MODEL

#############
28
CONFIGURING THE CONTROLLER

#############
29
STYLING THE VIEWS - NEW

#############
30
STYLING THE VIEWS - INDEX

#############
31
PAYPAL'S BRAINTREE - HOW IT WORKS

#############
32
PAYPAL'S BRAINTREE - SETUP

#############
33
INSTALLING THE GEM

#############
34
CONFIGURING THE CONTROLLER

#############
35
FINISHING PAYMENTS AND PLEDGES

#############
36
BACKGROUND JOBS - SETUP

#############
37
INSTALLING THE GEMS

#############
38
EXTRAS - FRIENDLY IDs

#############
39
IMPLEMENTING CANCANCAN

#############
40
FINISHING TOUCHES


